# PRD 功能缺失清单

**检查日期**: 2026-02-04
**对照文档**: `docs/PRD_MVP_2026-02-04.md`

---

## 一、观察者链接 (2.1) - 部分完成

### ✅ 已实现
- URL 格式 `/observer/{address}`
- 地址展示
- Workers 列表（名称、shares、难度、时间）
- 估计算力计算
- 30秒自动刷新

### ❌ 缺失功能

#### 界面功能
1. **复制按钮 / QR码**
   - PRD 要求: `[复制] [QR码]`
   - 状态: 未实现

2. **今日收益**
   - PRD 要求: `今日收益: 0.00123456 BTC`
   - 状态: 未实现（支付系统未完成）

3. **当前余额**
   - PRD 要求: `当前余额: 0.00876543 BTC`
   - 状态: 未实现（支付系统未完成）

4. **PPLNS窗口算力**
   - PRD 要求: `PPLNS窗口算力: 512.3 PH/s`
   - 状态: 未实现（需要单独计算）

5. **算力图表 (7天)**
   - PRD 要求: 显示 7 天历史
   - 状态: 只有当前实时数据

6. **最近份额 (最近100条)**
   - PRD 要求: 显示最近 100 条份额
   - 状态: 未实现

7. **支付记录**
   - PRD 要求: 显示历史支付
   - 状态: 未实现（支付系统未完成）

#### API 端点
1. **`GET /api/observer/{address}/shares?limit=100&offset=0`**
   - 状态: 未实现

2. **`GET /api/observer/{address}/workers`**
   - 状态: 未实现（workers 在主 API 中，但 observer 没有单独端点）

3. **`GET /api/observer/{address}/payouts`**
   - 状态: 未实现

#### 技术要求
1. **数据缓存 30秒**
   - 状态: 未实现，每次请求都查数据库

2. **静态页面生成**
   - 状态: 未实现

3. **实时更新 (WebSocket/SSE)**
   - 状态: 未实现，只有前端轮询

---

## 二、挖矿连接 (2.2) - 部分完成

### ✅ 已实现
- Stratum V1 协议
- 端口 3333
- 动态难度调整

### ❌ 缺失功能

1. **端口 3334 (NiceHash 优化)**
   - PRD 要求: 支持 NiceHash 协议
   - 状态: 未实现

2. **连接监控界面**
   - PRD 要求: 显示连接状态、份额提交率
   - 状态: 后端 API 有数据，但前端未展示

3. **难度调整历史**
   - PRD 要求: 难度调整历史
   - 状态: 未实现

---

## 三、PPLNS 算力计算 (2.3) - 基础完成

### ✅ 已实现
- PPLNS 窗口可配置
- 计算公式（核心 p2poolv2 实现）

### ❌ 缺失功能

1. **验证 API**
   - PRD 要求: 提供计算验证 API，每个区块可验证
   - 状态: 未实现

---

## 四、自动支付系统 (2.4) - 完全未实现 ⚠️

### ❌ 缺失功能

1. **支付逻辑**
   - 检查矿工余额
   - 构建 coinbase 交易
   - 广播到网络
   - 记录支付记录
   - 更新矿工余额
   - 状态: 完全未实现

2. **支付阈值**
   - 标准: 0.01 BTC
   - 手动: >= 0.001 BTC
   - Lightning: >= 0.0001 BTC
   - 状态: 未实现

3. **支付监控**
   - 支付队列状态
   - 交易确认追踪
   - 失败重试机制
   - 状态: 未实现

---

## 五、管理后台 (2.5) - 部分完成

### ✅ 已实现
- 仪表盘（基础）
- 登录认证
- 服务状态监控
- Workers 列表查看

### ❌ 缺失功能

#### 仪表盘
1. **实时算力统计**
   - PRD 要求: pool_hashrate_phs
   - 状态: 后端有数据，前端图表有但不明确

2. **待支付金额**
   - 状态: 未实现（支付系统未完成）

#### 矿工管理
1. **禁用/启用矿工**
   - PRD 要求: 可禁用特定矿工
   - 状态: 后端有 ban 功能，但前端未实现

2. **手动触发支付**
   - 状态: 未实现

#### 支付管理
1. **支付队列查看**
   - 状态: 未实现

2. **支付历史**
   - 状态: 未实现

3. **手动构建支付**
   - 状态: 未实现

#### 系统监控
1. **错误日志**
   - PRD 要求: 查看错误日志
   - 状态: 前端 showLogs() 存在但只显示固定内容

2. **性能指标**
   - 状态: 未实现

3. **2FA**
   - PRD 要求: 强制 2FA
   - 状态: 未实现

---

## 六、健康检查 (2.6) - 部分完成

### ✅ 已实现
- `/health` 端点（简化版）

### ❌ 缺失功能

1. **完整的 metrics 返回**
   - PRD 要求: pool_hashrate_phs, active_workers, shares_per_minute
   - 状态: 当前返回简化数据

---

## 七、非功能需求

### 3.1 性能要求
- ❌ 支持 1000+ 矿机 - 未测试
- ❌ 份额处理延迟 < 100ms - 未测试
- ❌ API 响应时间 < 200ms (p95) - 未测试

### 3.2 安全要求
- ✅ 速率限制已实现
- ❌ 管理后台 2FA - 未实现
- ❌ 定期安全审计 - 未进行

### 3.3 可靠性要求
- ❌ 数据自动备份 - 后端有备份模块，但未配置定时任务
- ❌ 自动故障恢复 - 未实现

### 3.4 可维护性要求
- ❌ 代码测试覆盖率 >= 60% - 未测试
- ❌ 完善的监控告警 - 未实现

---

## 总结

### 功能完成度

| 模块 | 完成度 | 说明 |
|------|--------|------|
| 观察者链接 | 40% | 基础功能完成，缺少收益、支付、历史数据 |
| 挖矿连接 | 70% | 核心功能完成，缺少监控界面 |
| PPLNS 计算 | 80% | 核心计算完成，缺少验证 API |
| 自动支付 | 0% | ⚠️ 完全未实现 |
| 管理后台 | 50% | 基础功能完成，缺少支付管理 |
| 健康检查 | 60% | 基础端点完成，数据不完整 |

### 关键缺失

**P0 缺失** (影响 MVP 上线):
1. ⚠️ **自动支付系统** - 完全未实现
2. ⚠️ **今日收益/余额显示** - 依赖支付系统
3. ⚠️ **算力图表 (7天)** - 需要历史数据存储
4. ⚠️ **支付记录** - 依赖支付系统

**P1 缺失** (影响用户体验):
1. 复制按钮 / QR码
2. 最近份额列表
3. 矿工禁用/启用
4. 2FA
5. NiceHash 端口支持

### 建议

**如果要快速上线 MVP**:
1. 暂时放弃"自动支付"，改为手动支付
2. 简化观察者页面，只显示当前数据
3. 接入矿机测试 Stratum 连接

**如果要完整实现 PRD**:
1. 优先实现自动支付系统（这是最大的缺失）
2. 添加历史数据存储（用于图表和记录）
3. 完善 API 端点

---

**检查人**: Claude (K4y)
**检查时间**: 2026-02-04
